<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lysted</title>
    <link rel="stylesheet" href="styleedit.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  </head>

  <body>
    <header>
      <a href="index.html" class="home-btn">
      <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Home">
      </a>
      Lysted
    </header>

    <!-- Title of page and add new button -->
    <h1>Edit Your Wishlist Items</h1>
    <button onclick="addNewItem()" class="add-btn">+ Add New Item</button>
    <div class="container" id="edit-container"></div>

    <footer>
      &copy; 2025 Lysted Tracker ~
      Love it? Lyst it!
    </footer>
    
    <script>
      let items = JSON.parse(localStorage.getItem("wishlistItems")) || [];
      items = items.filter(item => !item.archived); // hide archived
      const container = document.getElementById("edit-container");
      
      //Restrictions to price input: Only numbers and 1 "." Min=1 and Max= 1Mil
      function sanitizeNumberInput(input) {
      input.value = input.value.replace(/[^0-9.]/g, '');
      
      const parts = input.value.split('.');
      if (parts.length > 2) {
        input.value = parts[0] + '.' + parts[1];
      }
      
      const value = parseFloat(input.value);
      if (value < 1) {
        input.value = "";
      }
      if (value > 1000000) {
        input.value = "1000000";
      }
      
      }
      
      //Render editable wishlist item 
      function renderItems() {
        container.innerHTML = "";
      
        items.forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "edit-item";
      
          //Template with data attributes 
          div.innerHTML = `
            <label>Preview Image:</label>
            <img src="${item.image}" alt="Item Image" class="preview-img">
      
            <label>Change Image:</label>
            <div class="custom-file">
              <label class="custom-file-label">Choose Image
                <input type="file" class="image-input" accept="image/*">
              </label>
            </div>
      
            <label>Name:</label>
            <input type="text" class="name-input" value="${item.name}">
      
            <label>Description:</label>
            <textarea class="desc-input">${item.description}</textarea>
      
            <label>Price ($):</label>
            <input type="number" class="price-input" min="1" max="1000000" step="0.01" placeholder="e.g. 20" oninput="sanitizeNumberInput(this)">
      
            <div style="margin-top: 1rem;">
              <button class="save-btn">Save</button>
              <button class="delete-btn" style="margin-left: 0.5rem;">Delete</button>
            </div>
          `;
      
        container.appendChild(div);
      
        //Getting the elements inside the card
        const previewImg = div.querySelector(".preview-img");
        const fileInput = div.querySelector(".image-input");
        const nameInput = div.querySelector(".name-input");
        const descInput = div.querySelector(".desc-input");
        const priceInput = div.querySelector(".price-input");
        const saveBtn = div.querySelector(".save-btn");
        const deleteBtn = div.querySelector(".delete-btn");
        
      
        //Live image preview
        fileInput.addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              previewImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });
      
        //Save item
        saveBtn.addEventListener("click", () => {
          const priceValue = parseFloat(priceInput.value);
          if (isNaN(priceValue) || priceValue < 0 || priceValue > 1000000) {
            alert("Please enter a valid price between 1 and 1,000,000.");
            return;
          }
      
          items[index] = {
            name: nameInput.value,
            description: descInput.value,
            price: priceValue,
            image: previewImg.src,
            saved: items[index].saved || 0,
            transactions: items[index].transactions || [],
            confirmed: true,
            archived: items[index].archived || false
          };
      
          localStorage.setItem("wishlistItems", JSON.stringify(items));
          alert("Item saved!");
        });
      
        //Delete item
        deleteBtn.addEventListener("click", () => {
          if (confirm("Are you sure you want to delete this item?")) {
            items.splice(index, 1);
            localStorage.setItem("wishlistItems", JSON.stringify(items));
            renderItems();
          }
        });
      });
      }
      
      //Create a new item with blanks
      function addNewItem() {
      items.unshift({
        name: "",
        description: "",
        price: 0,
        image: "",
        saved: 0,
        transactions: [],
        confirmed: false 
      });
      
      localStorage.setItem("wishlistItems", JSON.stringify(items));
      renderItems();
      }
      
      window.addEventListener("beforeunload", function (e) {
      const unsaved = items.some(item => item.confirmed === false);
      if (unsaved) {
      e.preventDefault();
      e.returnValue = "";
      }
      });
      
      
      renderItems();
    </script>
  </body>

</html>
